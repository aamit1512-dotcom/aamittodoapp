# Trigger pipeline on push to main branch
trigger:
- main

# Use self-hosted agent pool
pool:
  name: Default

# Global variables
variables:
  NODE_VERSION: '18.x'

# Pipeline steps
steps:
# 1. Checkout source code
- checkout: self
  displayName: Checkout repository

# 2. Install Node.js
- task: NodeTool@0
  displayName: Install Node.js
  inputs:
    versionSpec: $(NODE_VERSION)

# 3. Cache npm dependencies (improves speed)
- task: Cache@2
  displayName: Cache npm packages
  inputs:
    key: 'npm | "$(Agent.OS)" | ad-reactjs/package-lock.json'
    path: $(Pipeline.Workspace)/.npm

# 4. Install npm dependencies
- script: npm ci --cache $(Pipeline.Workspace)/.npm
  workingDirectory: ad-reactjs
  displayName: Install npm dependencies

# 5. Build React application
- script: npm run build
  workingDirectory: ad-reactjs
  displayName: Build React app
